{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\anton\\\\Desktop\\\\FInt.Tchat\\\\dev\\\\Beta\\\\V1\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\anton\\\\Desktop\\\\FInt.Tchat\\\\dev\\\\Beta\\\\V1\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\anton\\\\Desktop\\\\FInt.Tchat\\\\dev\\\\Beta\\\\V1\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\anton\\\\Desktop\\\\FInt.Tchat\\\\dev\\\\Beta\\\\V1\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:\\\\Users\\\\anton\\\\Desktop\\\\FInt.Tchat\\\\dev\\\\Beta\\\\V1\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\anton\\\\Desktop\\\\FInt.Tchat\\\\dev\\\\Beta\\\\V1\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\anton\\\\Desktop\\\\FInt.Tchat\\\\dev\\\\Beta\\\\V1\\\\client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import ReactDOM from\"react-dom\";import api from\"../../../api\";var _require=require(\"../../../functions/validity.js\"),validityPseudo=_require.validityPseudo;var Setting=/*#__PURE__*/function(_Component){_inherits(Setting,_Component);var _super=_createSuper(Setting);function Setting(props){var _this;_classCallCheck(this,Setting);_this=_super.call(this,props);_this.handleChangeInputAvatar=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var files,avatar,type;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// .jpg,.jpeg,.png,.gif\nfiles=event.target.files;avatar=files[0];type=/image.*/;if(avatar.type.match(type)){_context.next=5;break;}return _context.abrupt(\"return\");case 5://if (avatar.size > (100*1024)) return\n_this.setState({selectedFiles:event.target.files});case 6:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();_this.handleChangeInputPseudo=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(event){var pseudo,rep;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:pseudo=event.target.value;rep=validityPseudo(pseudo);_this.setState({pseudo:{value:pseudo,warning:rep.warning,valid:rep.valid}});case 3:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x2){return _ref2.apply(this,arguments);};}();_this.state={selectedFiles:[],pseudo:{value:'x',warning:'',valid:false}};// Cette liaison est nécéssaire afin de permettre\n// l'utilisation de `this` dans la fonction de rappel.\n_this.handleUpdateUser=_this.handleUpdateUser.bind(_assertThisInitialized(_this));_this.resetAndHide=_this.resetAndHide.bind(_assertThisInitialized(_this));return _this;}// onChange management \n// Avatar\n_createClass(Setting,[{key:\"handleUpdateUser\",// Submit management\nvalue:function handleUpdateUser(){var _this2=this;// UploadAvatar // https://github.com/MaksymRudnyi/turorials/\nif(this.state.selectedFiles.length!==0){// FormData permet de stocker plusieur fichiers à la fois\nvar file=new FormData();var fileName=this.state.selectedFiles[0].name;// Ajoute le fichier au formData avec append\nfile.append('file',this.state.selectedFiles[0],\"\".concat(this.props.client.id,\".\").concat(fileName.substring(fileName.lastIndexOf(\".\")+1,fileName.length)));api.deleteFileById_avatar(this.props.client.id).then(function(res){if(res.data.success===true){// Envoie de la requête\napi.insertFile_avatar(file).then(function(res){console.log('Upload Success');}).catch(function(err){console.log('Upload Error');});}});}// UploadPseudo\nvar pseudo=this.state.pseudo;if(pseudo.valid===true){// Requête a l'api pour rechercher le pseudo\napi.getUserByPseudo(pseudo.value).then(function(res){// Je vérifie si le pseudo est déjà utilisé\n// sinon ont mes à jour l'utilisateur\nif(res.data.data!==null){_this2.setState({pseudo:{value:pseudo.value,warning:'ce pseudo est déjà utilisé'}});}else{_this2.resetAndHide();api.updateUserById(_this2.props.client.id,{data:{pseudo:pseudo.value}}).then(function(res){console.log(\"Mise à jour de l'utilisateur\");},function(error){console.log(\"Problème d'enregistrement dans la base de données\");console.log(error);});}});}else{if(pseudo.value.length===0){this.setState({pseudo:{value:pseudo.value,warning:'Ne peut être vide'}});}else{this.resetAndHide();}}}// Nettoyage du 'State' et fermeture\n},{key:\"resetAndHide\",value:function resetAndHide(){this.setState({selectedFiles:[],pseudo:{value:'x',warning:'',valid:false}});this.props.hide();}},{key:\"render\",value:function render(){var _this$state=this.state,pseudo=_this$state.pseudo,selectedFiles=_this$state.selectedFiles;// Récupération des données du client dans l’état local\nvar client=this.props.client;return this.props.isShowing?ReactDOM.createPortal(/*#__PURE__*/React.createElement(\"div\",{className:\"window\"},/*#__PURE__*/React.createElement(\"div\",{className:\"window-backdrop\",onClick:this.props.hide}),/*#__PURE__*/React.createElement(\"form\",{className:\"window-container\"},/*#__PURE__*/React.createElement(\"div\",{className:\"windowToolHeader\"},/*#__PURE__*/React.createElement(\"div\",{className:\"windowToolHeader-title\"},\"Param\\xE8tres\"),/*#__PURE__*/React.createElement(\"div\",{className:\"windowToolHeader-subtitle\"},\"Clic sur ton pseudo pour le modifier\")),/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body scroller\"},/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-divider\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title\"},\"Compte\"),/*#__PURE__*/React.createElement(\"div\",{className:\"bar\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-account\"},/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-account-avatar\"},/*#__PURE__*/React.createElement(\"img\",{className:\"avatar\",src:selectedFiles.length===0?client===null?null:\"https://collaps.xyz/api/file_avatar/id/\".concat(client.id):URL.createObjectURL(selectedFiles[0])//http://localhost:3000/\n,alt:\"user account\"}),/*#__PURE__*/React.createElement(\"input\",{className:\"avatarUploaderInput\",type:\"file\",accept:\".jpg,.jpeg,.png,.gif\",onChange:this.handleChangeInputAvatar}),/*#__PURE__*/React.createElement(\"div\",{className:\"avatarUploaderIcon\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-account-info\"},/*#__PURE__*/React.createElement(\"div\",{className:\"pseudo\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title\"},\"Pseudo \",pseudo.warning?/*#__PURE__*/React.createElement(\"span\",{className:\"title-warning\"},\"- \",pseudo.warning):null),/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},/*#__PURE__*/React.createElement(\"input\",{className:\"input\",type:\"text\",maxLength:\"32\",required:true,value:pseudo.value===\"x\"?client===null?null:client.pseudo:pseudo.value,onChange:this.handleChangeInputPseudo}))),/*#__PURE__*/React.createElement(\"div\",{className:\"id\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title\"},\"Id\"),/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},client.id)))),/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-divider\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title\"},\"Informations\"),/*#__PURE__*/React.createElement(\"div\",{className:\"bar\"})),/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-info\"},/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-info-compatibility\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title\"},\"Compatible\"),/*#__PURE__*/React.createElement(\"div\",{className:\"navigator\"},/*#__PURE__*/React.createElement(\"li\",null,\"Mozilla Firefox\"),/*#__PURE__*/React.createElement(\"li\",null,\"Google Chrome\"),/*#__PURE__*/React.createElement(\"li\",null,\"Apple Safari\"),/*#__PURE__*/React.createElement(\"li\",null,\"Microsoft Edge\"))),/*#__PURE__*/React.createElement(\"div\",{className:\"clientSetting-body-info-support\"},/*#__PURE__*/React.createElement(\"div\",{className:\"title\"},\"Support\"),/*#__PURE__*/React.createElement(\"div\",{className:\"navigator\"},/*#__PURE__*/React.createElement(\"li\",null,\"Windows\"),/*#__PURE__*/React.createElement(\"li\",null,\"MacOS\"),/*#__PURE__*/React.createElement(\"li\",null,\"Android\"),/*#__PURE__*/React.createElement(\"li\",null,\"iOS\"))))),/*#__PURE__*/React.createElement(\"div\",{className:\"windowToolFooter\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn-icon-default-red\",type:\"button\"},/*#__PURE__*/React.createElement(\"svg\",{viewBox:\"0 0 384 384\",\"aria-hidden\":\"false\",width:\"21\",height:\"21\",x:\"0\",y:\"0\"},/*#__PURE__*/React.createElement(\"path\",{fill:\"currentColor\",d:\"M341.333,0H42.667C19.093,0,0,19.093,0,42.667V128h42.667V42.667h298.667v298.667H42.667V256H0v85.333\\r C0,364.907,19.093,384,42.667,384h298.667C364.907,384,384,364.907,384,341.333V42.667C384,19.093,364.907,0,341.333,0z\"}),/*#__PURE__*/React.createElement(\"polygon\",{fill:\"currentColor\",points:\"151.147,268.48 181.333,298.667 288,192 181.333,85.333 151.147,115.52 206.293,170.667 0,170.667 0,213.333 \\r 206.293,213.333\"}))),/*#__PURE__*/React.createElement(\"div\",{className:\"windowToolFooter-btn\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn-text-default\",type:\"button\",onClick:this.handleUpdateUser},/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},\"Termin\\xE9\")),/*#__PURE__*/React.createElement(\"button\",{className:\"btn-text-simple\",type:\"button\",onClick:this.resetAndHide},/*#__PURE__*/React.createElement(\"div\",{className:\"content\"},\"Annuler\")))))),document.body):null;}}]);return Setting;}(Component);/*\r\n{selectedFiles.length == 0 ? \"rien\" : <img style={{maxWidth: '200px'}} src={URL.createObjectURL(selectedFiles[0])} alt={selectedFiles[0].originalname}/>}\r\n{selectedFiles.length == 0 ? \"rien\" : selectedFiles.map((file) => <img style={{maxWidth: '200px'}} src={`//localhost:8000/${file.filename}`} alt={file.originalname}/>)}\r\n\r\n*/export{Setting as default};","map":{"version":3,"sources":["C:/Users/anton/Desktop/FInt.Tchat/dev/Beta/V1/client/src/components/sidebar/windows/setting.js"],"names":["React","Component","ReactDOM","api","require","validityPseudo","Setting","props","handleChangeInputAvatar","event","files","target","avatar","type","match","setState","selectedFiles","handleChangeInputPseudo","pseudo","value","rep","warning","valid","state","handleUpdateUser","bind","resetAndHide","length","file","FormData","fileName","name","append","client","id","substring","lastIndexOf","deleteFileById_avatar","then","res","data","success","insertFile_avatar","console","log","catch","err","getUserByPseudo","updateUserById","error","hide","isShowing","createPortal","URL","createObjectURL","document","body"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport api from \"../../../api\"\r\nconst { validityPseudo } = require(\"../../../functions/validity.js\");\r\n\r\nexport default class Setting extends Component {\r\n  constructor(props) {\r\n    super(props)\r\n    this.state = {\r\n      selectedFiles: [],\r\n      pseudo: {\r\n        value: 'x',\r\n        warning: '',\r\n        valid: false\r\n      }\r\n    }\r\n\r\n    // Cette liaison est nécéssaire afin de permettre\r\n    // l'utilisation de `this` dans la fonction de rappel.\r\n    this.handleUpdateUser = this.handleUpdateUser.bind(this);\r\n    this.resetAndHide = this.resetAndHide.bind(this);\r\n  }\r\n\r\n  // onChange management \r\n\r\n  // Avatar\r\n  handleChangeInputAvatar = async event => {\r\n\r\n    // .jpg,.jpeg,.png,.gif\r\n\r\n    const files = event.target.files\r\n    const avatar = files[0]\r\n    const type = /image.*/\r\n\r\n    if (!avatar.type.match(type)) return\r\n\r\n    //if (avatar.size > (100*1024)) return\r\n\r\n    this.setState({\r\n      selectedFiles: event.target.files,\r\n    });\r\n  }\r\n\r\n  // Pseudo\r\n  handleChangeInputPseudo = async event => {\r\n    const pseudo = event.target.value\r\n    const rep = validityPseudo(pseudo);\r\n    this.setState({\r\n      pseudo: {\r\n        value: pseudo,\r\n        warning: rep.warning,\r\n        valid: rep.valid\r\n      }\r\n    })\r\n  }\r\n\r\n  // Submit management\r\n\r\n  handleUpdateUser() {\r\n\r\n    // UploadAvatar // https://github.com/MaksymRudnyi/turorials/\r\n    if (this.state.selectedFiles.length !== 0) {\r\n      // FormData permet de stocker plusieur fichiers à la fois\r\n      const file = new FormData();\r\n\r\n      const fileName = this.state.selectedFiles[0].name\r\n      // Ajoute le fichier au formData avec append\r\n      file.append('file', this.state.selectedFiles[0], `${this.props.client.id}.${fileName.substring(fileName.lastIndexOf(\".\") + 1, fileName.length)}`);\r\n\r\n      api.deleteFileById_avatar(this.props.client.id).then(res => {\r\n        if (res.data.success === true) {\r\n          // Envoie de la requête\r\n          api.insertFile_avatar(file)\r\n            .then((res) => {\r\n              console.log('Upload Success')\r\n            })\r\n            .catch((err) => {\r\n              console.log('Upload Error')\r\n            })\r\n        }\r\n      })\r\n    }\r\n\r\n    // UploadPseudo\r\n    const { pseudo } = this.state\r\n    if (pseudo.valid === true) {\r\n\r\n      // Requête a l'api pour rechercher le pseudo\r\n      api.getUserByPseudo(pseudo.value).then(res => {\r\n\r\n        // Je vérifie si le pseudo est déjà utilisé\r\n        // sinon ont mes à jour l'utilisateur\r\n        if (res.data.data !== null) {\r\n          this.setState({\r\n            pseudo: {\r\n              value: pseudo.value,\r\n              warning: 'ce pseudo est déjà utilisé'\r\n            }\r\n          })\r\n        } else {\r\n\r\n          this.resetAndHide()\r\n\r\n          api.updateUserById(this.props.client.id, { data: { pseudo: pseudo.value } }).then(\r\n            (res) => {\r\n              console.log(\"Mise à jour de l'utilisateur\")\r\n            },\r\n            (error) => {\r\n              console.log(\"Problème d'enregistrement dans la base de données\")\r\n              console.log(error)\r\n            })\r\n        }\r\n      })\r\n    } else {\r\n      if (pseudo.value.length === 0) {\r\n        this.setState({\r\n          pseudo: {\r\n            value: pseudo.value,\r\n            warning: 'Ne peut être vide'\r\n          }\r\n        })\r\n      } else {\r\n        this.resetAndHide()\r\n      }\r\n    }\r\n  }\r\n\r\n  // Nettoyage du 'State' et fermeture\r\n  resetAndHide() {\r\n    this.setState({\r\n      selectedFiles: [],\r\n      pseudo: {\r\n        value: 'x',\r\n        warning: '',\r\n        valid: false\r\n      }\r\n    })\r\n\r\n    this.props.hide()\r\n  }\r\n\r\n  render() {\r\n    const { pseudo, selectedFiles } = this.state\r\n    // Récupération des données du client dans l’état local\r\n    const client = this.props.client\r\n\r\n    return (\r\n      this.props.isShowing\r\n        ? ReactDOM.createPortal(\r\n          <div className=\"window\">\r\n            <div className=\"window-backdrop\" onClick={this.props.hide}></div>\r\n            <form className=\"window-container\">\r\n              <div className=\"windowToolHeader\">\r\n                <div className=\"windowToolHeader-title\">\r\n                  Paramètres\r\n                </div>\r\n                <div className=\"windowToolHeader-subtitle\">\r\n                  Clic sur ton pseudo pour le modifier\r\n                </div>\r\n              </div>\r\n              <div className=\"clientSetting-body scroller\">\r\n                <div className=\"clientSetting-body-divider\">\r\n                  <div className=\"title\">Compte</div><div className=\"bar\"></div>\r\n                </div>\r\n\r\n                <div className=\"clientSetting-body-account\">\r\n                  <div className=\"clientSetting-body-account-avatar\">\r\n                    <img className=\"avatar\" src={selectedFiles.length === 0 ? client === null ? null : `https://collaps.xyz/api/file_avatar/id/${client.id}` : URL.createObjectURL(selectedFiles[0])}//http://localhost:3000/\r\n                      alt=\"user account\" />\r\n                    <input className=\"avatarUploaderInput\" type=\"file\" accept=\".jpg,.jpeg,.png,.gif\" onChange={this.handleChangeInputAvatar} />\r\n                    <div className=\"avatarUploaderIcon\"></div>\r\n                  </div>\r\n                  <div className=\"clientSetting-body-account-info\">\r\n                    <div className=\"pseudo\">\r\n                      <div className=\"title\">Pseudo {pseudo.warning ? <span className=\"title-warning\">- {pseudo.warning}</span> : null}</div>\r\n                      <div className=\"content\">\r\n                        <input\r\n                          className=\"input\"\r\n                          type=\"text\"\r\n                          maxLength=\"32\"\r\n                          required\r\n                          value={pseudo.value === \"x\" ? client === null ? null : client.pseudo : pseudo.value}\r\n                          onChange={this.handleChangeInputPseudo}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div className=\"id\">\r\n                      <div className=\"title\">Id</div>\r\n                      <div className=\"content\">{client.id}</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div className=\"clientSetting-body-divider\">\r\n                  <div className=\"title\">Informations</div><div className=\"bar\"></div>\r\n                </div>\r\n\r\n                <div className=\"clientSetting-body-info\">\r\n                  <div className=\"clientSetting-body-info-compatibility\">\r\n                    <div className=\"title\">Compatible</div>\r\n                    <div className=\"navigator\">\r\n                      <li>Mozilla Firefox</li>\r\n                      <li>Google Chrome</li>\r\n                      <li>Apple Safari</li>\r\n                      <li>Microsoft Edge</li>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"clientSetting-body-info-support\">\r\n                    <div className=\"title\">Support</div>\r\n                    <div className=\"navigator\">\r\n                      <li>Windows</li>\r\n                      <li>MacOS</li>\r\n                      <li>Android</li>\r\n                      <li>iOS</li>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n              </div>\r\n              <div className=\"windowToolFooter\">\r\n                <button className=\"btn-icon-default-red\" type=\"button\">\r\n                  <svg viewBox=\"0 0 384 384\" aria-hidden=\"false\" width=\"21\" height=\"21\" x=\"0\" y=\"0\">\r\n                    <path fill=\"currentColor\" d=\"M341.333,0H42.667C19.093,0,0,19.093,0,42.667V128h42.667V42.667h298.667v298.667H42.667V256H0v85.333\r\n                      C0,364.907,19.093,384,42.667,384h298.667C364.907,384,384,364.907,384,341.333V42.667C384,19.093,364.907,0,341.333,0z\"/>\r\n                    <polygon fill=\"currentColor\" points=\"151.147,268.48 181.333,298.667 288,192 181.333,85.333 151.147,115.52 206.293,170.667 0,170.667 0,213.333 \r\n                      206.293,213.333\" />\r\n                  </svg>\r\n                </button>\r\n                <div className=\"windowToolFooter-btn\">\r\n                  <button className=\"btn-text-default\" type=\"button\" onClick={this.handleUpdateUser}>\r\n                    <div className=\"content\">Terminé</div>\r\n                  </button>\r\n                  <button className=\"btn-text-simple\" type=\"button\" onClick={this.resetAndHide}>\r\n                    <div className=\"content\">Annuler</div>\r\n                  </button>\r\n                </div>\r\n              </div>\r\n            </form>\r\n          </div>,\r\n          document.body\r\n        ) : null\r\n    )\r\n  }\r\n}\r\n\r\n/*\r\n{selectedFiles.length == 0 ? \"rien\" : <img style={{maxWidth: '200px'}} src={URL.createObjectURL(selectedFiles[0])} alt={selectedFiles[0].originalname}/>}\r\n{selectedFiles.length == 0 ? \"rien\" : selectedFiles.map((file) => <img style={{maxWidth: '200px'}} src={`//localhost:8000/${file.filename}`} alt={file.originalname}/>)}\r\n\r\n*/"]},"metadata":{},"sourceType":"module"}