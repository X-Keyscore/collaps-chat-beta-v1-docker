{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\anton\\\\Desktop\\\\collaps-chat\\\\dev\\\\Beta\\\\V1\\\\client\\\\src\\\\components\\\\sidebar\\\\ChannelsContacts.js\";\nimport React, { useEffect } from 'react';\nimport api from \"../../api\";\nimport { useUser } from '../../contexts/UserProvider';\nimport { useChannels } from '../../contexts/ChannelsProvider';\nexport default function ChannelsContacts() {\n  const {\n    client\n  } = useUser();\n  const {\n    channels,\n    setChannels,\n    selectedChannel,\n    setSelectedChannel,\n    setMessagesChannels\n  } = useChannels(); // Le \"useEffect\" est utilisé pour géré l'asynchrone\n\n  useEffect(() => {\n    // Je teste si le client est chargé\n    if (client === null) return; // Je teste si le client à des conversations\n\n    if (client.channels.length === 0) return setChannels([]); // Fonction asynchrone pour faire le rendu des channels du client\n\n    async function fetchRenderClientChannels() {\n      return renderChannels(client).then(channels => setChannels(channels));\n    } // Appel de la fonction\n\n\n    fetchRenderClientChannels();\n  }, [setChannels, client]); // Cette fonction renvoie les données du client\n\n  function renderChannels(client) {\n    return new Promise(resolve => {\n      // Variable pour stocker les channels du client\n      var clientChannels = client.channels; // Je filtre pour ne récupérer que les contacts privés\n\n      clientChannels.filter(channel => channel.type === \"private\").forEach((clientChannel, index) => {\n        // Je récupère les informations sur le destinataire grace à sont id\n        api.getChannelById(clientChannel.id).then(channel => {\n          console.log();\n          var channelRecipient = channel.data.channel.recipients.filter(recipient => recipient !== client.id)[0];\n          api.getUserById(channelRecipient).then(recipient => {\n            // Si le destinataire n'existe plus je le supprime des données du client et le channel\n            if (recipient.data.user === null) {\n              // Je boucle tous les \"channels\" du client\n              for (let i = 0; i < client.channels.length; i++) {\n                // Je teste si l'id du \"channel\" sélectionné correspond à l'id du \"channel\" passé dans la boucle\n                if (client.channels[i].id === channel.data.channel.id) {\n                  // Je supprime le \"channel\" dans la liste grace à sa position\n                  client.channels.splice(i, 1); // Je mets à jour le client\n\n                  api.updateUserById(client.id, {\n                    channels: client.channels\n                  }).then(res => {}); // Je supprime le channel\n\n                  api.deleteChannelById(channel.data.channel.id);\n                }\n              }\n            } // Je complète les informations existantes du destinataire avec celle de la base de données\n\n\n            var channelEdit = channel.data.channel; // Ajout des infos sur le desinataire\n\n            channelEdit.recipients = [{\n              id: recipient.data.id,\n              pseudo: recipient.data.pseudo\n            }]; // J'ajoute un element \"selected\" à \"channel\" est passe la valeur \"true\" au premier\n\n            Object.assign(channelEdit, {\n              selected: false\n            });\n            Object.assign(channelEdit, {\n              key: index\n            }); // Je mets à jour l'object la list des \"channels\" du client\n\n            clientChannels[index] = channelEdit;\n            if (client.channels.length === index + 1) return resolve(clientChannels);\n          });\n        });\n      });\n    });\n  } // Si \"client\" est \"null\" c'est qu'il est en chargement donc j'affiche chargement\n\n\n  if (channels === null) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sidebar-body-info\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 7\n      }\n    }, \"Chargement...\");\n  } // Si \"client.channels\" est vide c'est qu'il n'y a pas de constact donc j'affiche aucun contact\n\n\n  if (channels.length === 0) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"sidebar-body-info\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 7\n      }\n    }, \"Aucun contact\");\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, channels.map(channel => /*#__PURE__*/React.createElement(\"button\", {\n    key: channel.id,\n    className: `sidebar-body-contact ${selectedChannel === null ? null : selectedChannel.id === channel.id ? 'selected' : ''}`,\n    onClick: () => {\n      // Reset du tableau des messages\n      setMessagesChannels([]); // Je sélectionne le \"channel\"\n\n      setSelectedChannel(channel);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sidebar-body-contact-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sidebar-body-contact-content-avatar\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"svg\", {\n    width: \"40\",\n    height: \"32\",\n    viewBox: \"0 0 40 32\",\n    \"aria-hidden\": \"true\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"foreignObject\", {\n    x: \"0\",\n    y: \"0\",\n    width: \"32\",\n    height: \"32\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 19\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    className: \"avatar\",\n    src: \"https://collaps.xyz/collapsapi/api/file_avatar/id/\" + channel.recipients[0].id,\n    \"aria-hidden\": \"true\",\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"rect\", {\n    className: \"online\",\n    fill: \"currentColor\",\n    width: \"10\",\n    height: \"10\",\n    x: \"22\",\n    y: \"22\",\n    rx: \"15\",\n    ry: \"15\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 19\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"sidebar-body-contact-content-text\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"username\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"overflow\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 19\n    }\n  }, channel.recipients[0].pseudo)))))));\n}","map":{"version":3,"sources":["C:/Users/anton/Desktop/collaps-chat/dev/Beta/V1/client/src/components/sidebar/ChannelsContacts.js"],"names":["React","useEffect","api","useUser","useChannels","ChannelsContacts","client","channels","setChannels","selectedChannel","setSelectedChannel","setMessagesChannels","length","fetchRenderClientChannels","renderChannels","then","Promise","resolve","clientChannels","filter","channel","type","forEach","clientChannel","index","getChannelById","id","console","log","channelRecipient","data","recipients","recipient","getUserById","user","i","splice","updateUserById","res","deleteChannelById","channelEdit","pseudo","Object","assign","selected","key","map"],"mappings":"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","sourcesContent":["import React, { useEffect } from 'react';\n\nimport api from \"../../api\"\n\nimport { useUser } from '../../contexts/UserProvider';\nimport { useChannels } from '../../contexts/ChannelsProvider';\n\nexport default function ChannelsContacts() {\n  const { client } = useUser()\n  const { channels, setChannels, selectedChannel, setSelectedChannel, setMessagesChannels } = useChannels()\n\n  // Le \"useEffect\" est utilisé pour géré l'asynchrone\n  useEffect(() => {\n    // Je teste si le client est chargé\n    if (client === null) return\n    // Je teste si le client à des conversations\n    if (client.channels.length === 0) return setChannels([])\n    // Fonction asynchrone pour faire le rendu des channels du client\n    async function fetchRenderClientChannels() {\n      return renderChannels(client).then(channels => setChannels(channels))\n    }\n    // Appel de la fonction\n    fetchRenderClientChannels();\n  }, [setChannels, client])\n\n  // Cette fonction renvoie les données du client\n  function renderChannels(client) {\n    return new Promise((resolve) => {\n\n      // Variable pour stocker les channels du client\n      var clientChannels = client.channels\n\n      // Je filtre pour ne récupérer que les contacts privés\n      clientChannels.filter(channel => channel.type === \"private\").forEach((clientChannel, index) => {\n\n        // Je récupère les informations sur le destinataire grace à sont id\n        api.getChannelById(clientChannel.id).then((channel) => {\n\n          console.log()\n          var channelRecipient = channel.data.channel.recipients.filter(recipient => recipient !== client.id)[0]\n\n          api.getUserById(channelRecipient).then((recipient) => {\n\n            // Si le destinataire n'existe plus je le supprime des données du client et le channel\n            if (recipient.data.user === null) {\n              // Je boucle tous les \"channels\" du client\n              for (let i = 0; i < client.channels.length; i++) {\n                // Je teste si l'id du \"channel\" sélectionné correspond à l'id du \"channel\" passé dans la boucle\n                if (client.channels[i].id === channel.data.channel.id) {\n                  // Je supprime le \"channel\" dans la liste grace à sa position\n                  client.channels.splice(i, 1);\n                  // Je mets à jour le client\n                  api.updateUserById(client.id, { channels: client.channels }).then(res => { })\n                  // Je supprime le channel\n                  api.deleteChannelById(channel.data.channel.id)\n                }\n              }\n            }\n\n            // Je complète les informations existantes du destinataire avec celle de la base de données\n            var channelEdit = channel.data.channel\n\n            // Ajout des infos sur le desinataire\n            channelEdit.recipients = [{\n              id: recipient.data.id,\n              pseudo: recipient.data.pseudo\n            }]\n\n            // J'ajoute un element \"selected\" à \"channel\" est passe la valeur \"true\" au premier\n            Object.assign(channelEdit, { selected: false })\n            Object.assign(channelEdit, { key: index })\n\n            // Je mets à jour l'object la list des \"channels\" du client\n            clientChannels[index] = channelEdit\n\n            if (client.channels.length === index + 1) return resolve(clientChannels)\n\n          })\n        });\n      })\n    })\n  }\n\n  // Si \"client\" est \"null\" c'est qu'il est en chargement donc j'affiche chargement\n  if (channels === null) {\n    return (\n      <div className=\"sidebar-body-info\">Chargement...</div>\n    );\n  }\n  // Si \"client.channels\" est vide c'est qu'il n'y a pas de constact donc j'affiche aucun contact\n  if (channels.length === 0) {\n    return (\n      <div className=\"sidebar-body-info\">Aucun contact</div>\n    );\n  }\n  return (\n    <>\n      {\n        channels.map((channel) => (\n          <button\n            key={channel.id}\n            className={`sidebar-body-contact ${selectedChannel === null ? null : selectedChannel.id === channel.id ? 'selected' : ''}`}\n            onClick={() => {\n              // Reset du tableau des messages\n              setMessagesChannels([])\n              // Je sélectionne le \"channel\"\n              setSelectedChannel(channel)\n            }}\n          >\n            <div className=\"sidebar-body-contact-content\">\n              <div className=\"sidebar-body-contact-content-avatar\">\n\n                <svg width=\"40\" height=\"32\" viewBox=\"0 0 40 32\" aria-hidden=\"true\">\n                  <foreignObject x=\"0\" y=\"0\" width=\"32\" height=\"32\">\n                    <img className=\"avatar\" src={\"https://collaps.xyz/collapsapi/api/file_avatar/id/\" + channel.recipients[0].id} aria-hidden=\"true\" alt=\"\" />\n                  </foreignObject>\n                  <rect className=\"online\" fill=\"currentColor\" width=\"10\" height=\"10\" x=\"22\" y=\"22\" rx=\"15\" ry=\"15\"></rect>\n                </svg>\n\n              </div>\n              <div className=\"sidebar-body-contact-content-text\">\n                <div className=\"username\">\n                  <div className=\"overflow\">\n                    {channel.recipients[0].pseudo}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </button>\n        ))\n      }\n    </>\n  )\n}"]},"metadata":{},"sourceType":"module"}